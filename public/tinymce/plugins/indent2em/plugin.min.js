tinymce.PluginManager.add('indent2em', function(editor, url) {
  var pluginName='首行缩进';
  var global$1 = tinymce.util.Tools.resolve('tinymce.util.Tools');
  var indent2em_val = editor.getParam('indent2em_val', '0 0.25 0.5 0.75 1 1.25 1.5 1.75 2 2.25 2.5');
  editor.on('init', function() {
    editor.formatter.register({
      textindent: {
        selector: 'p,h1,h2,h3,h4,h5,h6,td,th,div,ul,ol,li,table,pre',
        styles: { 'text-indent': '%value' }
      }
    })
  })
  var doAct = function (value) {
    editor.formatter.apply('textindent', { value: value });
    editor.fire('change', {});
  };

  editor.ui.registry.getAll().icons.indent2em || editor.ui.registry.addIcon('indent2em','<svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="24" height="24"><path d="M170.666667 563.2v-102.4H887.466667v102.4zM170.666667 836.266667v-102.4H887.466667v102.4zM512 290.133333v-102.4H887.466667v102.4zM238.933333 341.333333V136.533333l204.8 102.4z" fill="#2c2c2c" p-id="5210"></path></svg>');

  editor.ui.registry.addMenuButton('indent2em', {
    icon: 'indent2em',
    tooltip: pluginName,
    fetch: function(callback) {
      var dom = editor.dom;
      var blocks = editor.selection.getSelectedBlocks();
      var act = 0;
      global$1.each(blocks, function(block) {
        if(act==0){
          act = dom.getStyle(block,'text-indent') ? dom.getStyle(block,'text-indent') : 0;
        }
      });
      var items = indent2em_val.split(' ').map(function(item){
        var text = item;
        var value = item + 'em';
        return {
          type: 'togglemenuitem',
          text: text,
          active : act==value ? true :false,
          onAction: function() {
            doAct(value);
          }
        };
      });
      callback(items);
    }
  });

  // editor.ui.registry.addMenuItem('indent2em', {
  //     text: pluginName,
  //     onAction: function() {
  //         doAct();
  //     }
  // });

  // return {
  //   getMetadata: function () {
  //     return  {
  //       name: pluginName,
  //       url: "http://tinymce.ax-z.cn/more-plugins/indent2em.php",
  //     };
  //   }
  // };
});
